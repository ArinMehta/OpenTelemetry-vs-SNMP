receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

  # (Optional) self-scrape the Collector's own metrics
  prometheus:
    config:
      scrape_configs:
        - job_name: "otel-collector"
          scrape_interval: 10s
          static_configs:
            - targets: ["0.0.0.0:8888"]

  hostmetrics:
    collection_interval: 10s
    scrapers: { cpu: {}, disk: {}, filesystem: {}, load: {}, memory: {}, network: {}, paging: {}, processes: {} }

processors:
  memory_limiter:
    check_interval: 1s
    limit_mib: 512
    spike_limit_mib: 128
  batch:
    timeout: 10s
    send_batch_size: 1024
  resource:
    attributes:
      - { key: service.name, value: network-monitoring, action: upsert }
      - { key: deployment.environment, value: development, action: upsert }
  attributes:
    actions:
      - { key: network.protocol, action: insert, value: tcp }
  filter:
    metrics:
      exclude:
        match_type: strict
        metric_names: [unwanted.metric]

exporters:
  # Exposes metrics for Prometheus to scrape at :8889
  prometheus:
    endpoint: "0.0.0.0:8889"
    namespace: otel
    const_labels: { source: opentelemetry }

  # Use debug for traces/logs (prints to Collector logs). Replace with Tempo/Jaeger/Loki later if you want.
  debug:
    verbosity: normal

extensions:
  health_check: { endpoint: 0.0.0.0:13133 }
  pprof:        { endpoint: 0.0.0.0:1777 }
  zpages:       { endpoint: 0.0.0.0:55679 }

service:
  extensions: [health_check, pprof, zpages]

  pipelines:
    traces:
      receivers:  [otlp]
      processors: [memory_limiter, batch, resource]
      exporters:  [debug]          # <-- NOT prometheus

    metrics:
      receivers:  [otlp, prometheus, hostmetrics]
      processors: [memory_limiter, batch, resource, attributes]
      exporters:  [prometheus, debug]

    logs:
      receivers:  [otlp]
      processors: [memory_limiter, batch, resource]
      exporters:  [debug]          # <-- NOT prometheus

  telemetry:
    logs:
      level: info
    metrics:
      level: detailed
